# 開発に貢献しよう

開発を一緒に進めて、良い桐朋祭を目指しましょう。

## 約束事

### 開発の進行

開発は、[仕様書][spec]に基づいて[GitHub Projects][projects]を運営・管理し、[GitHub Issues][issues]で取り組みながら進めます。

取り組めそうなIssueを見つけたら、自分が取り組むことをコメントで宣言しましょう。また、実装できたら[Pull Request][pull]を作成して、元のIssueに
[リンク][link an issue]しましょう。そのうち、メンターからのコードレビューを経てマージされるので、通知をつけて待ちわびて下さい。

[spec]: ./specification.md

[projects]: https://github.com/toho-festival/toho-festival-2021/projects

[issues]: https://github.com/toho-festival/toho-festival-2021/issues

[pull]: https://github.com/toho-festival/toho-festival-2021/pull

[link an issue]: https://docs.github.com/ja/github/managing-your-work-on-github/linking-a-pull-request-to-an-issue

### 開発の環境

開発には、Git、Node.js、Yarnを使用します。手元の環境にインストールされていない方は、予めインストールしておいて下さい。

## 手順

ここではGitはすべてコマンドラインで操作する前提で書いていますが、もしお使いのIDEの機能を用いてGitの操作をする場合は、適宜読み替えてください。

### 手順1 clone

作業するパソコンで、Shell(Linux)かterminal(macOS)、Power Shell(Windows)を起動し、以下のコマンドを実行しましょう。

```shell
git clone github.com:/toho-festival/website-2021.git
```

> リモートへのアクセスへは、ssh接続を使用して下さい。設定方法は[こちら][git ssh]をお読み下さい。

[git ssh]: https://docs.github.com/ja/github/authenticating-to-github/connecting-to-github-with-ssh

### 手順2 元にするブランチ・コミットを選び選択する

[ブランチの運用法](#ブランチの運用法)に従って、実装しようとしている機能の取り入れられる予定のバージョンの`develop/<version>`ブランチを選びましょう。

```shell
git checkout -b develop/<version> origin/develop/<version>
```

### 手順3 新しいブランチを作る

実装する際の変更を記録していくためのブランチを作りましょう。ブランチ名は、機能追加であれば`feature/<feature_name>`の`<feature_name>`に、
取り組む内容を英語小文字のケバブケースで表したものを入れたものにして下さい。

フッターを実装する場合の例：
```shell
git checkout -b feature/footer-development
```

### 手順4 実装する

依存しているパッケージがまだインストールされていないので、次のコマンドを実行して下さい。

```shell
yarn install
```

[コーディング規約](#コーディング規約)に沿って実装しましょう。

実際の挙動を確認しながら開発したいということは多いと思います。このコマンドを実行することで、手元の環境で実行しながら開発が進められます。

```shell
yarn dev
```

### 手順5 commit

実装したらcommitをして、成果を保存しましょう。

```shell
git add .
git commit -m "何をしたか、詳細に記す"
```

""の内側には、そこまでに加えた変更を書きましょう。例えば、`"フッターの最下部に学校のサイトへのリンクなどを追加した"`というようにしましょう。
> `-m "..."`を省略すると、デフォルトで設定されているテキストエディタが開きます。そこで編集しても良いでしょう。

また、commitは意味のある最小の単位に分けて行いましょう。
> ❌良くない例
> - フッターを実装していたらコンフィグファイルもいじっちゃったけどまとめてコミットしちゃおう！
> - 1行書いて疲れたからとりあえずコミット

> ⭕良い例
> - フッターが完成したからコミットしよう

`commit --amend`も活用しつつ、分かりやすいコミットログを作っていきましょう。

### 手順6 push

取り組んでいたIssueのための実装が終わって全てコミットし終えたら、GitHubにアップロード(push)しましょう。

```shell
git push -u origin [ブランチ名]
```

> そのブランチ二度目以降の`push`の場合は、
> ```shell
> git push
> ```
> として下さい。

フォークしたリポジトリのページを開いて、作業していたブランチを選択すると、成果がアップロードされていることが確認できます。

### 手順7 Pull Requestをつくる

スクリーンショットのように、Pull requestボタンが表示されるので、ボタンを押して、何のIssueのために何をしたかなどの説明を書いて、Pull Requestをつくりましょう。

![image](https://user-images.githubusercontent.com/56545698/115422897-4b4ae580-a238-11eb-9c8e-71b2add40365.png)

また、できたPull Requestのページを開くと、右の列にLinked Issuesという段があります。歯車ボタンを押して関係するIssueを選択して下さい。

![image](https://user-images.githubusercontent.com/56545698/115423779-11c6aa00-a239-11eb-9f8d-2812d93c40f1.png)

大仕事もこれで一区切りです👏。

> 管理者がコードを確認して、必要に応じて修正を提案したりするので、すぐに気付けるように、右上にあるWatchボタンを押して通知が来るようにしておきましょう。
>
> ![スクリーンショット](https://user-images.githubusercontent.com/56545698/115531870-3752c280-a2d0-11eb-93a2-a7045ac0880d.png)

## ブランチの運用法
このリポジトリでは、以下のブランチを基本に運用していきます。

#### `main`ブランチ
デプロイ用。ここにコミットすると本番用サーバーにデプロイされる。\
`staging`で動作確認をして問題なかったら、このブランチにマージ。

#### `staging`ブランチ
動作確認用。ここにコミットすると確認用サーバーにデプロイされる。\
そのバージョンで追加する機能が`develop/<version>`に出揃ったら、このブランチにマージ。一つのバージョンが確認している間は他のバージョンはマージしてはならない。

#### `develop/<version>`ブランチ
そのバージョンの追加機能をまとめる用。プルリクは基本ここ。\
`<version>`には、バージョンを表す文字列を入れる。例：`v1.19.1`。バージョンの命名は[セマンティックバージョニング][semver]に準拠。\
`main`ブランチから分岐させる。\
直前バージョンがstagingを終えたら、`staging`をマージして前バージョンまでの変更を取り入れる。

[semver]: https://semver.org/lang/ja/

#### `feature/<feature_name>`ブランチ
機能を実際に追加する用。各自が勝手に作っていく。\
その機能が取り込まれる予定となっているバージョンの`develop/<version>`から分岐させる。\
完成したら、目的の`develop/<version>`ブランチにプルリクを出す。

#### その他
基本的なバグとりは元の`feature/*`ブランチで行ってから再度マージするが、複数の機能に横断的に存在したりする場合は、上記の命名に被らない名前でブランチを作って作業しても良い。例：`fix-link-no-rel`など。

## コーディング規約

このリポジトリでは複数のメンバーが共同で開発していますが、各々が好き勝手に書いてしまうとお互い読みづらく、開発速度も落ちてしまいます。そこで、お互いに読みやすいコードを書くためのルールを定めます。

### ディレクトリ構成

以下に大まかなルールを示します。具体例は実際のリポジトリを参考にして下さい

```
/
|-public # 画像などの静的ファイルを置く
|-src
| |-components # コンポーネントを定義するファイルを置く
| | |-[種類] # キャメルケースで1文字目大文字
| | | |-[用途など].tsx # ケバブケース全て小文字
| | |-[名前].tsx # キャメルケースで1文字目大文字 分類するまでもないもの
| |-pages # 使用しているフレームワーク、Next.jsで厳密に定められている。リンク参照
| |-scripts # コンポーネントの定義に関わらないJavaScript/TypeScriptを置く
|   |-[種類] # ケバブケースで全て小文字
|   | |-[用途など].tsx # ケバブケースで全て小文字
|   |-[名前].tsx # ケバブケースで全て小文字 分類するまでもないもの
|-types # ライブラリの型定義を補強する型定義ファイルなどを置く
|-[ファイル名].[拡張子]　# コンフィグファイルなどを置く
```

- `src/pages`ディレクトリのルールは[このページ][next pages]のルールを厳守
- `public`ディレクトリのNext.jsでの扱われ方は、[このページを][next public]を参照
- できるだけ種類ごとの分類をして、ファイルが探しやすくなるように心がけましょう。一方で一つしか分類されないようであれば、分けない。
- キャメルケースやケバブケースなどの指定を遵守

[next pages]: https://nextjs.org/docs/routing/introduction

[next public]: https://nextjs.org/docs/basic-features/static-file-serving

### JavaScript/TypeScriptの書き方

- **式の終わりのセミコロンは書け**
- インデントは全て空白2文字で行う。
- 読みやすさのため、一行120字を超えないよう努力する。（義務ではない

#### 変数宣言

- 常に`const`を用いて宣言する。`let`を使いたくなったら、関数に切り出して解決できないかなどを検討する。
- `var`は使ってはならない。
- 命名はキャメルケースで行い、1文字目を小文字にする。

#### 関数宣言

- 命名はキャメルケースで行い、1文字目を小文字にする。但し、コンポーネントの場合は1文字目を大文字にする。
- `function 名前() {}`の構文は使わず、`const 名前 = function() {};`または`const 名前 = () => {};`と書く。
- アロー関数(`() => {}`)を用いる際、省略できる括弧は省略しても良い

#### クラス宣言

- 命名はキャメルケースで行い、1文字目を大文字にする。
- TypeScriptとの親和性が低いため、極力使わない。

#### 制御構文

- `if`, `for`, `while`を使う際、一行で収まる場合は波括弧を省略してもいいが、そうでない場合は省略してはならない。
- `goto`は使用しない。

その他、より厳しい規制が必要になったときには、ESLintを導入するかもしれません。

### HTMLの書き方

- インデントは全て空白2文字で行う
- 読みやすさのため、一行120字を超えないよう努力する。（義務ではない）
- タグをコードの複数行に渡って使用する際は、開きタグと綴じタグを原則同じインデントの深さにする。

### CSSの当て方

- インデントは全て空白2文字で行う
- 特定のデザインを実現するために、複数の異なるコンポーネントに別々にCSSを書いてはならない。[参考][CSS SRP]
- コンポーネントの外部の状況に依存せず、常に同じ見た目になるように作るべきであり、また使う側もそう作られていることを前提に使うべきである。[参考][CSS capsule]

[CSS SRP]: https://blog.uhy.ooo/entry/2020-10-15/react-paired-css/

[CSS capsule]: https://blog.uhy.ooo/entry/2020-12-19/css-component-design/
